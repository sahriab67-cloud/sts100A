<!doctype html>
<html lang="ms">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tempahan Pakej PLATINUM ‚Äî Majlis Jamuan Amal 100 Tahun STS</title>
<style>
:root{
  --header:#0f3b77; --bg:#f7f9fc; --seat-size:32px; --price:180;
  --booked:#bdbdbd; --selected:#2ecc71;
  --vvip:#fdf3d7; --vvip-border:#fcd34d;
  --tent-gap:18px;
}
*{box-sizing:border-box;font-family:Inter,system-ui,Arial,Helvetica,sans-serif}
body{margin:0;background:var(--bg);color:#0f172a}
header{background:var(--header);color:#fff;display:flex;align-items:center;gap:12px;padding:10px 18px;justify-content:space-between}
header img{height:56px;width:auto}
.header-center{flex:1;text-align:center}
.header-center h1{margin:2px 0;font-size:18px}
.header-center p{margin:0;font-size:13px;opacity:.95}
main{max-width:1200px;margin:18px auto;padding:12px}
.note{max-width:1200px;margin:0 auto 12px;padding:0 12px;color:#374151;text-align:center;transition:.3s ease}
.controls{display:flex;gap:10px;align-items:center;justify-content:center;margin:12px 0;flex-wrap:wrap}
button.primary{background:var(--header);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
button.ghost{background:#fff;border:1px solid #e6eefc;color:var(--header);padding:9px 12px;border-radius:8px;cursor:pointer}

/* layout 5 x 2 */
.tents-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:var(--tent-gap);align-items:start;margin:12px 0}
@media (max-width:1100px){ .tents-grid{grid-template-columns:repeat(2,1fr)} }

.tent{background:#fff;border-radius:12px;padding:10px;border:4px solid #e6eefc;min-height:260px;display:flex;flex-direction:column;align-items:center}
.tent-name{font-weight:800;margin-bottom:8px}
.tent-inner{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;justify-items:center;align-items:center;width:100%}
.tent-vvip{background:var(--vvip);border:4px solid var(--vvip-border)}

/* table */
.table-slot{width:110px;height:110px;position:relative;border-radius:50%;background:#f9fafb;border:2px solid #e2e8f0;display:flex;align-items:center;justify-content:center}
.table-center{width:36px;height:36px;border-radius:50%;background:#0f3b77;color:#fff;font-weight:700;border:1px solid #cbd5e1;display:flex;align-items:center;justify-content:center;font-size:12px;z-index:3}

/* seat */
.seat{position:absolute;width:var(--seat-size);height:var(--seat-size);border-radius:50%;
  display:flex;align-items:center;justify-content:center;font-size:10px;border:1px solid #3b82f6;background:#fff;color:#0f172a;
  cursor:pointer;user-select:none;transform:translate(-50%,-50%);z-index:2}
.seat.booked{background:var(--booked);color:#fff;cursor:not-allowed}
.seat.selected{background:var(--selected);color:#fff}

/* footer */
footer{background:var(--header);color:#fff;text-align:center;padding:12px;margin-top:18px}

/* modal */
.modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,.45);display:none;align-items:center;justify-content:center;z-index:999}
.modal{width:520px;background:#fff;border-radius:10px;padding:16px;box-shadow:0 10px 40px rgba(2,6,23,.3)}
.field{margin-bottom:8px}
label{display:block;font-size:13px;margin-bottom:6px}
input{width:100%;padding:8px;border-radius:8px;border:1px solid #e6eefc}
.invalid-resit{color:#9b1c1c;margin-top:6px;font-weight:700;display:none}
@media(max-width:600px){ .modal{width:92%} }
</style>
</head>
<body>

<header>
  <img src="logo_sts.png" alt="Logo STS" onerror="this.style.display='none'">
  <div class="header-center">
    <h1>Tempahan Pakej PLATINUM ‚Äî Majlis Jamuan Amal 100 Tahun STS</h1>
    <p>Hubungi Urusetia Alumni STS: 011-55742917(Cg Azlan)/011-21441240(Cg Ajul)</p>
  </div>
  <img src="logo_100yrs.png" alt="100 Tahun STS" onerror="this.style.display='none'">
</header>

<main>
  <div class="note">Susunan khemah 5 √ó 2 ‚Äî Khemah C (VVIP) tidak menerima tempahan. Harga RM180/kerusi. Pilih kerusi, isikan butiran dan sahkan.</div>

  <div class="controls">
    <button class="primary" id="openBookingBtn">ü™ë Buat Tempahan</button>
    <button class="ghost" id="refreshBtn">üîÑ Muat Semula Pelan</button>
    <button class="ghost" id="downloadBtn">üíæ Muat Turun Semua (CSV)</button>
    <button class="ghost" id="adminBtn">üîí Paparan Admin</button>
  </div>

  <div class="tents-grid" id="tentsContainer" aria-live="polite"></div>
</main>

<!-- Booking modal -->
<div class="modal-backdrop" id="bookingBackdrop">
  <div class="modal" role="dialog" aria-modal="true">
    <h3>Borang Tempahan</h3>
    <form id="bookingForm">
      <div class="field"><label>Nama Penuh</label><input id="fName" required></div>
      <div class="field"><label>No. Telefon</label><input id="fPhone" required></div>
      <div class="field"><label>Batch / Tahun</label><input id="fBatch" required></div>
      <div class="field"><label>No. Resit (STS100Axxx)</label><input id="fResit" required placeholder="STS100A001"></div>
      <div id="resitError" class="invalid-resit">‚ö†Ô∏è Nombor resit tidak sah untuk Pakej A. Sila hubungi urusetia alumni.</div>
      <div class="field" id="selectedSummary">Tiada kerusi dipilih.</div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button type="button" class="ghost" id="cancelBooking">Batal</button>
        <button type="submit" class="primary" id="confirmBooking">Sahkan Tempahan</button>
      </div>
    </form>
  </div>
</div>

<!-- Admin modal -->
<div class="modal-backdrop" id="adminBackdrop">
  <div class="modal" role="dialog" aria-modal="true">
    <h3>Paparan Admin</h3>
    <div class="field"><label>Kata Laluan Admin</label><input id="adminPass" type="password"></div>
    <div style="display:flex;gap:8px;justify-content:flex-end">
      <button class="ghost" id="adminCancel">Tutup</button>
      <button class="primary" id="adminLogin">Log Masuk</button>
    </div>
    <p style="margin-top:8px;font-size:13px;color:#6b7280">(Kata laluan admin: <strong>STSADMIN2025</strong>)</p>
  </div>
</div>

<footer>¬© 2026 Sekolah Tinggi Segamat ‚Äî Tempahan STS100A</footer>

<script>
/* ========== CONFIG ========== */
const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycby64_g8vOI_CidHL3QhUExCxcBlMKaxdr_kNeAf8_a-VA59IE6tcwmR6MLzrF4ni-Pk9A/exec';
const TENT_MAP = [['A','B','C','D','E'],['F','G','H','I','J']];
const MEJA_PER_TENT = 4;
const SEATS_PER_TABLE = 8;
const PRICE = 180;
const ADMIN_PASS = 'STSADMIN2025';

const $ = (s,ctx=document)=>ctx.querySelector(s);
let selectedSeats=new Set(), serverBooked=new Set();

/* ---------- BUILD TENTS ---------- */
function buildTents(){
  const cont=$('#tentsContainer'); cont.innerHTML='';
  for(const row of TENT_MAP){
    for(const t of row){
      const tent=document.createElement('div');
      tent.className='tent'+(t==='C'?' tent-vvip':'');
      tent.innerHTML=`<div class="tent-name">Khemah ${t}${t==='C'?' (VVIP)':''}</div><div class="tent-inner"></div>`;
      const inner=tent.querySelector('.tent-inner');
      if(t==='C'){ inner.innerHTML='<div style="grid-column:1/-1;font-size:13px;color:#92400e">Kawasan Tetamu Kehormat ‚Äî Tiada meja/kerusi</div>'; cont.appendChild(tent); continue; }
      for(let m=1;m<=MEJA_PER_TENT;m++){
        const table=document.createElement('div'); table.className='table-slot';
        const center=document.createElement('div'); center.className='table-center'; center.textContent='T'+m;
        table.appendChild(center);
        const cx=55,cy=55,r=38;
        for(let s=1;s<=SEATS_PER_TABLE;s++){
          const angle=(s-1)*(2*Math.PI/SEATS_PER_TABLE);
          const x=cx+Math.cos(angle)*r, y=cy+Math.sin(angle)*r;
          const seat=document.createElement('div');
          seat.className='seat'; seat.style.left=x+'px'; seat.style.top=y+'px';
          const id=`${t}-T${m}-S${s}`; seat.dataset.seatid=id; seat.textContent=`${t}${m}${s}`;
          seat.addEventListener('click',onSeatClick); table.appendChild(seat);
        }
        inner.appendChild(table);
      }
      cont.appendChild(tent);
    }
  }
  markBooked();
}

/* ---------- SEAT STATES ---------- */
function markBooked(){
  document.querySelectorAll('.seat').forEach(e=>{
    const id=e.dataset.seatid;
    e.classList.remove('booked','selected');
    if(serverBooked.has(id)) e.classList.add('booked');
    else if(selectedSeats.has(id)) e.classList.add('selected');
  });
  const sum=$('#selectedSummary');
  if(sum) sum.textContent=selectedSeats.size===0?'Tiada kerusi dipilih.':`Kerusi dipilih: ${Array.from(selectedSeats).join(', ')} ‚Äî Jumlah RM${selectedSeats.size*PRICE}`;
}
function onSeatClick(e){
  const el=e.currentTarget; const id=el.dataset.seatid;
  if(el.classList.contains('booked')) return alert('Maaf, kerusi telah ditempah.');
  selectedSeats.has(id)?selectedSeats.delete(id):selectedSeats.add(id);
  markBooked();
}

/* ---------- SERVER LOAD ---------- */
function handleServerBookings(d){
  serverBooked.clear();
  if(Array.isArray(d)) d.forEach(r=>{
    if(r.khemah&&r.meja&&r.kerusi) serverBooked.add(`${r.khemah}-T${r.meja}-S${r.kerusi}`);
    else if(r.kod) serverBooked.add(r.kod);
  });
  markBooked();
}
function loadBookings(){ fetch(WEBAPP_URL+'?action=load').then(r=>r.json()).then(handleServerBookings).catch(console.warn); }

/* ---------- BOOKING ---------- */
async function submitBooking(){
  if(selectedSeats.size===0) return alert('Sila pilih kerusi dahulu.');
  const n=$('#fName').value.trim(), p=$('#fPhone').value.trim(), b=$('#fBatch').value.trim(), r=$('#fResit').value.trim().toUpperCase();
  if(!/^STS100A\d{3}$/.test(r)) return alert('‚ö†Ô∏è Nombor resit tidak sah untuk Pakej A.');
  const code='STS100A-'+Math.random().toString(36).slice(2,9).toUpperCase();
  for(const id of selectedSeats){
    const [k,t,s]=id.split('-'); const params=new URLSearchParams({nama:n,telefon:p,batch:b,resit:r,khemah:k,meja:t.replace('T',''),kerusi:s.replace('S',''),harga:PRICE,kod_tempahan:code});
    await fetch(WEBAPP_URL+'?'+params.toString(),{method:'GET',mode:'no-cors'});
  }
  alert('‚úÖ Tempahan dihantar. Menunggu pelan dikemas kini...');
  selectedSeats.clear(); markBooked();
  const note=$('.note'); const old=note.textContent; note.textContent='üîÑ Sedang mengemas kini pelan... sila tunggu sebentar.';
  setTimeout(()=>{ loadBookings(); note.textContent=old; },4000);
  $('#bookingBackdrop').style.display='none';
}

/* ---------- EVENTS ---------- */
$('#openBookingBtn').onclick=()=>{$('#bookingBackdrop').style.display='flex';$('#fName').focus();};
$('#cancelBooking').onclick=()=>$('#bookingBackdrop').style.display='none';
$('#refreshBtn').onclick=loadBookings;
$('#bookingForm').onsubmit=e=>{e.preventDefault();submitBooking();};

/* ---------- INIT ---------- */
document.addEventListener('DOMContentLoaded',()=>{buildTents();loadBookings();});
</script>
</body>
</html>
